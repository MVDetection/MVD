static int h264_format_attr_sdp_parse(struct ast_format_attr *format_attr, const char *attributes)
{
	char *attribs = ast_strdupa(attributes), *attrib;
	format_attr->format_attr[H264_ATTR_KEY_REDUNDANT_PIC_CAP] = H264_ATTR_KEY_UNSET;
	format_attr->format_attr[H264_ATTR_KEY_PARAMETER_ADD] = H264_ATTR_KEY_UNSET;
	format_attr->format_attr[H264_ATTR_KEY_PACKETIZATION_MODE] = H264_ATTR_KEY_UNSET;
	format_attr->format_attr[H264_ATTR_KEY_LEVEL_ASYMMETRY_ALLOWED] = H264_ATTR_KEY_UNSET;
	while ((attrib = strsep(&attribs, ";"))) {
		unsigned int val;
		unsigned long int val2;
		char sps[H264_MAX_SPS_PPS_SIZE], pps[H264_MAX_SPS_PPS_SIZE];
		if (sscanf(attrib, "profile-level-id=%lx", &val2) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_PROFILE_IDC] = ((val2 >> 16) & 0xFF);
			format_attr->format_attr[H264_ATTR_KEY_PROFILE_IOP] = ((val2 >> 8) & 0xFF);
			format_attr->format_attr[H264_ATTR_KEY_LEVEL] = (val2 & 0xFF);
		} else if (sscanf(attrib, "sprop-parameter-sets=%[^','],%s", sps, pps) == 2) {
			unsigned char spsdecoded[H264_MAX_SPS_PPS_SIZE] = { 0, }, ppsdecoded[H264_MAX_SPS_PPS_SIZE] = { 0, };
			int i;
			ast_base64decode(spsdecoded, sps, sizeof(spsdecoded));
			ast_base64decode(ppsdecoded, pps, sizeof(ppsdecoded));
			format_attr->format_attr[H264_ATTR_KEY_SPS_LEN] = 0;
			format_attr->format_attr[H264_ATTR_KEY_PPS_LEN] = 0;
			for (i = 0; i < H264_MAX_SPS_PPS_SIZE; i++) {
				if (spsdecoded[i]) {
					format_attr->format_attr[H264_ATTR_KEY_SPS + i] = spsdecoded[i];
					format_attr->format_attr[H264_ATTR_KEY_SPS_LEN]++;
				}
				if (ppsdecoded[i]) {
					format_attr->format_attr[H264_ATTR_KEY_PPS + i] = ppsdecoded[i];
					format_attr->format_attr[H264_ATTR_KEY_PPS_LEN]++;
				}
			}
		} else if (sscanf(attrib, "max-mbps=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_MBPS] = val;
		} else if (sscanf(attrib, "max-fs=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_FS] = val;
		} else if (sscanf(attrib, "max-cpb=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_CPB] = val;
		} else if (sscanf(attrib, "max-dpb=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_DPB] = val;
		} else if (sscanf(attrib, "max-br=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_BR] = val;
		} else if (sscanf(attrib, "max-smbps=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_SMBPS] = val;
		} else if (sscanf(attrib, "max-fps=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_FPS] = val;
		} else if (sscanf(attrib, "redundant-pic-cap=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_REDUNDANT_PIC_CAP] = val;
		} else if (sscanf(attrib, "parameter-add=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_PARAMETER_ADD] = val;
		} else if (sscanf(attrib, "packetization-mode=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_PACKETIZATION_MODE] = val;
		} else if (sscanf(attrib, "sprop-interleaving-depth=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_SPROP_INTERLEAVING_DEPTH] = val;
		} else if (sscanf(attrib, "sprop-deint-buf-req=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_SPROP_DEINT_BUF_REQ] = val;
		} else if (sscanf(attrib, "deint-buf-cap=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_DEINT_BUF_CAP] = val;
		} else if (sscanf(attrib, "sprop-init-buf-time=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_SPROP_INIT_BUF_TIME] = val;
		} else if (sscanf(attrib, "sprop-max-don-diff=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_SPROP_MAX_DON_DIFF] = val;
		} else if (sscanf(attrib, "max-rcmd-nalu-size=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_MAX_RCMD_NALU_SIZE] = val;
		} else if (sscanf(attrib, "level-asymmetry-allowed=%30u", &val) == 1) {
			format_attr->format_attr[H264_ATTR_KEY_LEVEL_ASYMMETRY_ALLOWED] = val;
		}
	}
	return 0;
}
